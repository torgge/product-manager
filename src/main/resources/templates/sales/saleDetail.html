{#include layout/base}
{#title}Sale Order #{sale.id} - Product Manager{/title}

<a href="/sales" class="rh-btn rh-btn--link rh-mb-lg" style="display: inline-block;">&larr; Back to Sales</a>

{#if sale}
<div class="rh-card" style="max-width: 900px;">
    <div class="rh-card__header">
        <h1 class="rh-card__title">Sale Order #{sale.id}</h1>
    </div>
    <div class="rh-card__body">
        <dl style="display: grid; grid-template-columns: 1fr 2fr; gap: var(--rh-space-md);">
            <dt class="rh-text-secondary">Customer</dt>
            <dd>{sale.customer.name}</dd>

            <dt class="rh-text-secondary">Order Date</dt>
            <dd>{sale.orderDate}</dd>

            <dt class="rh-text-secondary">Status</dt>
            <dd>
                {#if sale.status.name() == 'PENDING'}
                <span class="rh-label rh-label--warning">Pending</span>
                {#else if sale.status.name() == 'CONFIRMED'}
                <span class="rh-label rh-label--info">Confirmed</span>
                {#else if sale.status.name() == 'RECEIVED'}
                <span class="rh-label rh-label--success">Delivered</span>
                {#else}
                <span class="rh-label rh-label--danger">Cancelled</span>
                {/if}
            </dd>

            <dt class="rh-text-secondary">Total Amount</dt>
            <dd style="font-size: 1.5rem; font-weight: 600; color: var(--rh-color-interactive-primary);">${sale.totalAmount}</dd>

            {#if sale.notes}
            <dt class="rh-text-secondary">Notes</dt>
            <dd>{sale.notes}</dd>
            {/if}
        </dl>
    </div>
    <div class="rh-card__footer">
        <div class="rh-flex rh-flex--gap-md">
            {#if sale.status.name() == 'PENDING'}
            <form method="post" action="/sales/{sale.id}/confirm" style="display: inline;">
                <button type="submit" class="rh-btn rh-btn--primary">Confirm Order</button>
            </form>
            <form method="post" action="/sales/{sale.id}/cancel" style="display: inline;">
                <button type="submit" class="rh-btn rh-btn--danger">Cancel Order</button>
            </form>
            {#else if sale.status.name() == 'CONFIRMED'}
            <form method="post" action="/sales/{sale.id}/deliver" style="display: inline;">
                <button type="submit" class="rh-btn rh-btn--primary">Mark as Delivered</button>
            </form>
            <form method="post" action="/sales/{sale.id}/cancel" style="display: inline;">
                <button type="submit" class="rh-btn rh-btn--danger">Cancel Order</button>
            </form>
            {/if}
        </div>
    </div>
</div>

<!-- Items Table -->
<div class="rh-card rh-mt-xl" style="max-width: 900px;">
    <div class="rh-card__header">
        <h2 class="rh-card__title">Order Items</h2>
    </div>
    {#if sale.items && sale.items.size() > 0}
    <table class="rh-table">
        <thead>
            <tr>
                <th>Product</th>
                <th>Quantity</th>
                <th>Unit Price</th>
                <th>Subtotal</th>
            </tr>
        </thead>
        <tbody>
            {#for item in sale.items}
            <tr>
                <td><strong>{item.product.name}</strong></td>
                <td>{item.quantity}</td>
                <td>${item.unitPrice}</td>
                <td style="font-weight: 600; color: var(--rh-color-interactive-primary);">${item.subtotal}</td>
            </tr>
            {/for}
        </tbody>
    </table>
    {#else}
    <div class="rh-empty-state">
        <h3 class="rh-empty-state__title">No items</h3>
        <p class="rh-empty-state__body">This sale order has no items.</p>
    </div>
    {/if}
</div>
{#else}
<div class="rh-card">
    <div class="rh-empty-state">
        <h3 class="rh-empty-state__title">Sale order not found</h3>
        <p class="rh-empty-state__body">The requested sale order does not exist.</p>
        <a href="/sales" class="rh-btn rh-btn--primary">Back to Sales</a>
    </div>
</div>
{/if}

{/include}
