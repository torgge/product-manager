{#include layout/base}
{#title}Products - Product Manager{/title}

<div class="rh-page-header">
    <h1 class="rh-page-header__title">Products</h1>
    <a href="/products/new" class="rh-btn rh-btn--primary">Add Product</a>
</div>

<div class="rh-card rh-mb-lg">
    <div class="rh-card__body">
        <form method="get" action="/products" class="rh-flex rh-flex--gap-sm">
            <input class="rh-form-control" type="text" name="search" placeholder="Search products..." value="{search}" style="flex: 1; max-width: 400px;">
            <button type="submit" class="rh-btn rh-btn--secondary">Search</button>
            {#if search}
            <a href="/products" class="rh-btn rh-btn--link">Clear</a>
            {/if}
        </form>
    </div>
</div>

{#if products.isEmpty()}
<div class="rh-card">
    <div class="rh-empty-state">
        <div class="rh-empty-state__icon">
            <svg width="64" height="64" fill="currentColor" viewBox="0 0 24 24">
                <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm-1 14H5c-.55 0-1-.45-1-1V7h16v10c0 .55-.45 1-1 1z"/>
            </svg>
        </div>
        <h3 class="rh-empty-state__title">No products found</h3>
        <p class="rh-empty-state__body">
            {#if search}
            No products match your search criteria. Try a different search term.
            {#else}
            There are no products yet. Add your first product to get started.
            {/if}
        </p>
        <a href="/products/new" class="rh-btn rh-btn--primary">Add Product</a>
    </div>
</div>
{#else}
<div class="rh-card">
    <table class="rh-table">
        <thead>
            <tr>
                <th>Name</th>
                <th>Category</th>
                <th>Price</th>
                <th>Stock</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {#for product in products}
            <tr>
                <td>
                    <strong>{product.name}</strong>
                    {#if product.description}
                    <br><span class="rh-text-sm rh-text-secondary">{product.description}</span>
                    {/if}
                </td>
                <td>
                    {#if product.category}
                    <span class="rh-label rh-label--info">{product.category}</span>
                    {#else}
                    <span class="rh-text-secondary">N/A</span>
                    {/if}
                </td>
                <td>${product.price}</td>
                <td>
                    {#if stockMap.get(product.id) > 0}
                    <span class="rh-label rh-label--success">{stockMap.get(product.id)} units</span>
                    {#else}
                    <span class="rh-label rh-label--danger">Out of stock</span>
                    {/if}
                </td>
                <td>
                    <div class="rh-flex rh-flex--gap-sm">
                        <a href="/products/{product.id}" class="rh-btn rh-btn--secondary rh-btn--sm">View</a>
                        <a href="/products/{product.id}/edit" class="rh-btn rh-btn--secondary rh-btn--sm">Edit</a>
                        <form method="post" action="/products/{product.id}/delete" style="display: inline;">
                            <button type="submit" class="rh-btn rh-btn--danger rh-btn--sm" onclick="return confirm('Are you sure you want to delete this product?')">Delete</button>
                        </form>
                    </div>
                </td>
            </tr>
            {/for}
        </tbody>
    </table>
</div>
{/if}

{/include}
